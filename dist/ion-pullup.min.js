angular.module("ionic-pullup",[]).constant("ionPullUpFooterState",{COLLAPSED:"COLLAPSED",MINIMIZED:"MINIMIZED",EXPANDED:"EXPANDED"}).constant("ionPullUpFooterBehavior",{HIDE:"HIDE",EXPAND:"EXPAND"}).directive("ionPullUpFooter",[function(){return{restrict:"AE",scope:{state:"=?",onExpand:"&",onCollapse:"&",onMinimize:"&",allowMidRange:"="},controller:["$scope","$element","$attrs","$timeout","$rootScope","$window","$ionicPlatform","ionPullUpFooterState","ionPullUpFooterBehavior",function(t,e,n,o,i,a,r,s,l){function u(){g=document.querySelector("ion-tabs"),D=g&&g.classList.contains("tabs-bottom"),E=document.querySelector("ion-nav-bar .nav-bar-block[nav-bar=entering] > .bar-header"),I=g?g.querySelector(".tabs").offsetHeight:0,P=E?E.offsetHeight:0}function c(){M.height=M.maxHeight>0?M.maxHeight:a.innerHeight-P-m-I,e.css({height:M.height+"px"}),M.initialState==s.MINIMIZED?h():f()}function d(){o(function(){c()},300),e.css({transition:"none",padding:0})}function p(){M.lastPosY=0,e.css({"-webkit-transform":"translate3d(0, 0, 0)",transform:"translate3d(0, 0, 0)"}),e.css({transition:"300ms ease-in-out",padding:0}),t.onExpand(),t.state=s.EXPANDED}function f(){M.lastPosY=g?M.height-I:M.height-M.defaultHeight,e.css({"-webkit-transform":"translate3d(0, "+M.lastPosY+"px, 0)",transform:"translate3d(0, "+M.lastPosY+"px, 0)"}),t.onCollapse(),t.state=s.COLLAPSED}function h(){M.lastPosY=M.height,e.css({"-webkit-transform":"translate3d(0, "+M.lastPosY+"px, 0)",transform:"translate3d(0, "+M.lastPosY+"px, 0)"}),t.onMinimize(),t.state=s.MINIMIZED}var g,D,E,I,P,m=0,v=!1,b=!1,C=!1,M={height:0,posY:0,lastPosY:0,defaultHeight:e[0].offsetHeight,maxHeight:parseInt(n.maxHeight,10)||0,initialState:n.initialState?n.initialState.toUpperCase():s.COLLAPSED,defaultBehavior:n.defaultBehavior?n.defaultBehavior.toUpperCase():l.EXPAND};n.$observe("disableTap",function(t){v="true"===t}),n.$observe("disableDrag",function(t){b="true"===t}),n.$observe("disableMinimizedState",function(t){C="true"===t}),this.$onInit=function(){o(function(){u(),e.css({transition:"300ms ease-in-out",padding:0}),g&&D&&e.css("bottom",I+"px")}),d()},this.setHandleHeight=function(t){m=t},this.getHeight=function(){return e[0].offsetHeight},this.getBackground=function(){return a.getComputedStyle(e[0]).background},this.getInitialState=function(){return M.initialState},this.getDefaultBehavior=function(){return M.defaultBehavior},this.onTap=function(e){v||(e.gesture.srcEvent.preventDefault(),e.gesture.preventDefault(),o(function(){t.state==s.COLLAPSED?M.defaultBehavior==l.HIDE?t.state=s.MINIMIZED:t.state=s.EXPANDED:t.state==s.MINIMIZED?M.defaultBehavior==l.HIDE?t.state=s.COLLAPSED:t.state=s.EXPANDED:t.state=M.initialState==s.MINIMIZED?s.MINIMIZED:s.COLLAPSED}))},this.onDrag=function(n){if(!b)switch(n.gesture.srcEvent.preventDefault(),n.gesture.preventDefault(),n.type){case"dragstart":e.css("transition","none");break;case"drag":var i=Math.round(n.gesture.deltaY);if(M.posY=+i+M.lastPosY,C&&t.state===s.COLLAPSED&&i>0)return;if(M.posY<0||M.posY>M.height)return;e.css({"-webkit-transform":"translate3d(0, "+M.posY+"px, 0)",transform:"translate3d(0, "+M.posY+"px, 0)"});break;case"dragend":e.css({transition:"300ms ease-in-out"}),t.allowMidRange?M.lastPosY=M.posY:o(function(){M.lastPosY>M.posY?t.state=s.EXPANDED:M.lastPosY<M.posY&&(t.state=M.initialState==s.MINIMIZED?s.MINIMIZED:s.COLLAPSED)})}};var $=t.$watch("state",function(e,n){if(void 0!==n&&e!=n){switch(e){case s.COLLAPSED:f();break;case s.EXPANDED:p();break;case s.MINIMIZED:h()}i.$broadcast("ionPullUp:tap",t.state,M.defaultBehavior)}});t.$on("$destroy",$),r.ready(function(){a.addEventListener("orientationchange",d),r.on("resume",d)})}],compile:function(t,e){e.defaultHeight&&t.css("height",parseInt(e.defaultHeight,10)+"px"),t.addClass("bar bar-footer")}}}]).component("ionPullUpContent",{require:{FooterController:"^ionPullUpFooter"},controller:["$element","$attrs",function(t,e){this.$onInit=function(){var n=this.FooterController,o=n.getHeight();t.css({display:"block","margin-top":o+"px",width:"100%"}),e.scroll&&"TRUE"==e.scroll.toUpperCase()&&t.css({"overflow-y":"scroll","overflow-x":"hidden"})}}]}).component("ionPullUpBar",{require:{FooterController:"^ionPullUpFooter"},controller:["$element",function(t){this.$onInit=function(){var e=this.FooterController,n=e.getHeight();t.css({display:"flex",height:n+"px",position:"absolute",right:"0",left:"0"})}}]}).directive("ionPullUpTrigger",["$ionicGesture",function(t){return{restrict:"AE",require:"^ionPullUpFooter",link:function(e,n,o,i){t.on("tap",i.onTap,n),t.on("drag dragstart dragend",i.onDrag,n)}}}]).component("ionPullUpHandle",{require:{FooterController:"^ionPullUpFooter"},controller:["$scope","$element","$attrs","ionPullUpFooterState","ionPullUpFooterBehavior","$ionicGesture","$ionicPlatform","$timeout","$window",function(t,e,n,o,i,a,r,s,l){function u(t,n){f&&h&&(e.find("i").removeClass([f,h].join(" ")),t==o.COLLAPSED?n==i.HIDE?e.find("i").addClass(h):e.find("i").addClass(f):t==o.MINIMIZED?n==i.HIDE?e.find("i").addClass(f):e.find("i").addClass(f):e.find("i").addClass(h))}function c(){s(function(){e.css("left",(l.innerWidth-p)/2+"px")},300)}var d=parseInt(n.height,10)||25,p=parseInt(n.width,10)||100,f=n.iconExpand,h=n.iconCollapse;e.css({display:"block","background-color":"inherit",position:"absolute",top:1-d+"px",left:(l.innerWidth-p)/2+"px",height:d+"px",width:p+"px","text-align":"center"}).append("<i>"),this.$onInit=function(){var t=this.FooterController;a.on("tap",t.onTap,e),a.on("drag dragstart dragend",t.onDrag,e),t.setHandleHeight(d);var n=t.getInitialState(),o=t.getDefaultBehavior();u(n,o),c()},t.$on("ionPullUp:tap",function(t,e,n){u(e,n)}),r.ready(function(){l.addEventListener("orientationchange",c),r.on("resume",c)})}]});